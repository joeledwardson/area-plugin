{"version":3,"file":"area-plugin.common.js","sources":["../src/background.js","../src/restrictor.js","../src/snap.js","../src/utils.js","../src/zoom-at.js","../src/index.js"],"sourcesContent":["export class Background {\n    constructor(editor, element) {\n        if (!element) return;\n        const el = element instanceof HTMLElement ? element : document.createElement('div');\n     \n        el.classList += ` rete-background ${element === true ? 'default' : ''}`;\n        editor.view.area.appendChild(el);\n    }\n}","export class Restrictor {\n    constructor(editor, scaleExtent, translateExtent) {\n        this.editor = editor;\n        this.scaleExtent = scaleExtent;\n        this.translateExtent = translateExtent;\n\n        if (scaleExtent)\n            editor.on('zoom', this.restrictZoom.bind(this));\n        if (translateExtent)\n            editor.on('translate', this.restrictTranslate.bind(this));\n    }\n\n    restrictZoom(data) {\n        const se = typeof this.scaleExtent === 'boolean' ? { min: 0.1, max: 1 } : this.scaleExtent;\n        const tr = data.transform;\n\n        if (data.zoom < se.min)\n            data.zoom = se.min;\n        else if (data.zoom > se.max)\n            data.zoom = se.max;\n    }\n\n    restrictTranslate(data) {\n        const te = typeof this.translateExtent === 'boolean' ? { width: 5000, height: 4000 } : this.translateExtent;\n        const { container } = this.editor.view;\n        const k = data.transform.k;\n        const [kw, kh] = [te.width * k, te.height * k];\n        const cx = container.clientWidth / 2;\n        const cy = container.clientHeight / 2;\n\n        data.x -= cx;\n        data.y -= cy;\n        \n        if (data.x > kw)\n            data.x = kw;\n        else if (data.x < - kw)\n            data.x = - kw;\n        \n        if (data.y > kh)\n            data.y = kh;\n        else if (data.y < - kh)\n            data.y = - kh;\n        \n        data.x += cx;\n        data.y += cy;\n    }\n}","export class SnapGrid {\n    constructor(editor, { size = 16, dynamic = true }) {\n        this.editor = editor;\n        this.size = size;\n\n        if (dynamic)\n            this.editor.on('nodetranslate', this.onTranslate.bind(this))\n        else\n            this.editor.on('rendernode', ({ node, el }) => {\n                el.addEventListener('mouseup', this.onDrag.bind(this, node));\n                el.addEventListener('touchend', this.onDrag.bind(this, node));\n                el.addEventListener('touchcancel', this.onDrag.bind(this, node));\n            });\n    }\n\n    onTranslate(data) {\n        const { x, y } = data;\n\n        data.x = this.snap(x);\n        data.y = this.snap(y);\n    }\n\n    onDrag(node) {\n        const [ x, y ] = node.position;\n\n        node.position[0] = this.snap(x);\n        node.position[1] = this.snap(y);\n        console.log(this, x, y, node.position)\n        \n        this.editor.view.nodes.get(node).update();\n        this.editor.view.updateConnections({ node });\n    }\n    \n    snap(value) {\n        return Math.round(value/this.size) * this.size;\n    }\n}","const min = (arr) => arr.length === 0 ? 0 : Math.min(...arr);\nconst max = (arr) => arr.length === 0 ? 0 : Math.max(...arr);\n\nexport function nodesBBox(editor, nodes) {\n    const left = min(nodes.map(node => node.position[0]));\n    const top = min(nodes.map(node => node.position[1]));\n    const right = max(nodes.map(node => node.position[0] + editor.view.nodes.get(node).el.clientWidth));\n    const bottom = max(nodes.map(node => node.position[1] + editor.view.nodes.get(node).el.clientHeight));\n    \n    return {\n        left,\n        right,\n        top,\n        bottom,\n        width: Math.abs(left - right),\n        height: Math.abs(top - bottom),\n        getCenter: () => {\n            return [\n                (left + right) / 2,\n                (top + bottom) / 2\n            ];\n        }\n    };\n}","import { nodesBBox } from './utils';\n\nexport function zoomAt(editor, nodes = editor.nodes) {\n    const bbox = nodesBBox(editor, nodes);\n    const [x, y] = bbox.getCenter();\n    const [w, h] = [editor.view.container.clientWidth, editor.view.container.clientHeight];\n    const { area } = editor.view;\n\n    var [kw, kh] = [w / bbox.width, h / bbox.height]\n    var k = Math.min(kh * 0.9, kw * 0.9, 1);\n\n    area.transform.x = area.container.clientWidth / 2 - x * k;\n    area.transform.y = area.container.clientHeight / 2 - y * k;\n    area.zoom(k, 0, 0);\n    \n    area.update();\n}","import './style.sass';\nimport { Background } from './background';\nimport { Restrictor } from './restrictor';\nimport { SnapGrid } from './snap';\nimport { zoomAt } from './zoom-at';\n\nfunction install(editor, params) {\n    let background = params.background || false;\n    let snap = params.snap || false;\n    let scaleExtent = params.scaleExtent || false;\n    let translateExtent = params.translateExtent || false;\n\n    if (background) {\n        this._background = new Background(editor, background);\n    }\n    if (scaleExtent || translateExtent) {\n        this._restrictor = new Restrictor(editor, scaleExtent, translateExtent)\n    }\n    if (snap) {\n        this._snap = new SnapGrid(editor, snap);\n    }\n}    \n\nexport default {\n    name: \"area-plugin\",\n    install,\n    zoomAt\n}"],"names":["Background","editor","element","el","HTMLElement","document","createElement","classList","view","area","appendChild","Restrictor","scaleExtent","translateExtent","on","restrictZoom","bind","restrictTranslate","data","se","min","max","transform","zoom","te","width","height","container","k","kw","kh","cx","clientWidth","cy","clientHeight","x","y","SnapGrid","size","dynamic","onTranslate","node","addEventListener","onDrag","snap","position","console","log","nodes","get","update","updateConnections","value","Math","round","arr","length","nodesBBox","left","map","top","right","bottom","abs","getCenter","zoomAt","bbox","w","h","install","params","background","_background","_restrictor","_snap","name"],"mappings":"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"}